<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">Kaetram-Open/server/js/util/formulas.js | kaetram</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Kaetram is an open-source game-engine created to aid those interested in entering the game development realm. The codebase is simple, clean, and intuitive, and is intended to be used as a learning tool. The original idea is based off Little Workshop&apos;s demo game - BrowserQuest. The assets have remained the same, but the code itself has been completely wiped and redone from the ground up."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="kaetram"><meta property="twitter:description" content="Kaetram is an open-source game-engine created to aid those interested in entering the game development realm. The codebase is simple, clean, and intuitive, and is intended to be used as a learning tool. The original idea is based off Little Workshop&apos;s demo game - BrowserQuest. The assets have remained the same, but the code itself has been completely wiped and redone from the ground up."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/Veradictus/Kaetram-Open"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">Kaetram-Open/server/js/util/formulas.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* global module */

const Formulas = {},
    Utils = require(&apos;./utils&apos;),
    Constants = require(&apos;./constants&apos;);

Formulas.LevelExp = [];

module.exports = Formulas;

Formulas.getDamage = (attacker, target, special) =&gt; {
    const maxDamage = Formulas.getMaxDamage(attacker, target, special),
        accuracy = Utils.randomInt(0, attacker.level);

    return Utils.randomInt(accuracy, maxDamage);
};

Formulas.getMaxDamage = (attacker, target, special) =&gt; {
    if (!attacker || !target)
        return;

    let damageDealt, damageAbsorbed, damageAmplifier = 1, absorptionAmplifier = 1,
        usingRange = attacker.weapon ? attacker.weapon.isRanged() : attacker.isRanged(),
        weaponLevel = attacker.weapon ? attacker.weapon.getLevel() : attacker.weaponLevel,
        armourLevel = attacker.armour ? attacker.armour.getDefense() : attacker.armourLevel,
        pendant = attacker.pendant ? attacker.pendant : null,
        ring = attacker.ring ? attacker.ring : null,
        boots = attacker.boots ? attacker.boots : null,
        targetArmour = target.armour ? target.armour.getDefense() : target.armourLevel,
        targetPendant = target.pendant ? target.pendant : null,
        targetRing = target.ring ? target.ring : null,
        targetBoots = target.boots ? target.boots : null,
        isPlayer = attacker.type === &apos;player&apos;;

    damageDealt = (isPlayer ? 10 : 0) + attacker.level + ((attacker.level * weaponLevel) / 4) + ((attacker.level + weaponLevel * armourLevel) / 8);

    /**
     * Apply ranged damage deficit
     */

    if (usingRange)
        damageDealt /= 1.275;

    if (special)
        damageDealt *= 1.0575;

    /**
     * Apply special amulets
     */

    if (pendant &amp;&amp; pendant.pendantLevel &gt; 0)
        damageAmplifier *= pendant.getBaseAmplifier();

    if (ring &amp;&amp; ring.ringLevel &gt; 0)
        damageAmplifier *= ring.getBaseAmplifier();

    if (boots &amp;&amp; boots.bootsLevel &gt; 0)
        damageAmplifier *= boots.getBaseAmplifier();

    /**
     * Just so amplifiers don&apos;t get out of hand.
     */

    if (damageAmplifier &gt; 1.60)
        damageAmplifier = 1.60;

    damageDealt *= damageAmplifier;

    damageAbsorbed = target.level + (targetArmour / 2);

    if (targetPendant)
        absorptionAmplifier *= targetPendant.getBaseAmplifier();

    if (targetRing)
        absorptionAmplifier *= targetRing.getBaseAmplifier();

    if (targetBoots)
        absorptionAmplifier *= targetBoots.getBaseAmplifier();

    damageAbsorbed *= absorptionAmplifier;

    let damage = damageDealt - damageAbsorbed;

    damage = Math.ceil(damage);

    if (isNaN(damage) || !damage || damage &lt; 0)
        damage = 0;

    return damage;
};

Formulas.getCritical = (attacker, target) =&gt; {
    if (!attacker || !target)
        return;

    /**
     * The critical is the player&apos;s max hit plus *= critical multiplier of the weapon
     */

    let damage = Formulas.getDamage(attacker, target),
        multiplier = attacker.weapon.abilityLevel / 10;

    return damage *= multiplier;
};

Formulas.getWeaponBreak = (attacker, target) =&gt; {
    if (!attacker || !target)
        return;

    const targetArmour = target.getArmourLevel();

    /**
     * The chance a weapon will break ....
     */

    const breakChance = Utils.randomRange(1, 100);

    return breakChance &gt; 75;
};


Formulas.getAoEDamage = (attacker, target) =&gt; {
    /**
     * Preliminary setup until this function is expanded
     * and fits in the necessary algorithms.
     */

    return Formulas.getDamage(attacker, target);
};

Formulas.nextExp = experience =&gt; {
    if (experience &lt; 0)
        return -1;

    for (let i = 1; i &lt; Formulas.LevelExp.length; i++) {
        if (experience &lt; Formulas.LevelExp[i])
            return Formulas.LevelExp[i];
    }
};

Formulas.prevExp = experience =&gt; {
    if (experience &lt; 0)
        return -1;

    for (let i = Constants.MAX_LEVEL; i &gt; 0; i--) {
        if (experience &gt; Formulas.LevelExp[i])
            return Formulas.LevelExp[i];
    }
};

Formulas.expToLevel = experience =&gt; {
    if (experience &lt; 0)
        return -1;

    for (let i = 1; i &lt; Formulas.LevelExp.length; i++) {
        if (experience &lt; Formulas.LevelExp[i])
            return i;
    }
};

Formulas.getRewardExperience = player =&gt; {
    if (!player)
        return;

    return (5 + player.level) * player.level;
};

Formulas.getMaxHitPoints = level =&gt; {
    return 100 + (level * 30);
};

Formulas.getMaxMana = level =&gt; {
    return 10 + (level * 8);
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
