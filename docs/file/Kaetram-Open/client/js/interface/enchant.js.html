<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">Kaetram-Open/client/js/interface/enchant.js | Kaetram</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="A modern HTML5 multiplayer adventure!"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="Kaetram"><meta property="twitter:description" content="A modern HTML5 multiplayer adventure!"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">Kaetram-Open/client/js/interface/enchant.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">define([&apos;jquery&apos;], function($) {

    return Class.extend({

        init: function(game, intrface) {
            var self = this;

            self.game = game;
            self.interface = intrface;

            self.body = $(&apos;#enchant&apos;);
            self.container = $(&apos;#enchantContainer&apos;);
            self.enchantSlots = $(&apos;#enchantInventorySlots&apos;);

            self.selectedItem = $(&apos;#enchantSelectedItem&apos;);
            self.selectedShards = $(&apos;#enchantShards&apos;);
            self.confirm = $(&apos;#confirmEnchant&apos;);
            self.shardsCount = $(&apos;#shardsCount&apos;);

            self.confirm.css({
                &apos;left&apos;: &apos;70%&apos;,
                &apos;top&apos;: &apos;80%&apos;
            });

            $(&apos;#closeEnchant&apos;).click(function() {
                self.hide();
            });

            self.confirm.click(function() {
                self.enchant();
            });
        },

        resize: function() {
            var self = this;

            self.load();
        },

        load: function() {
            var self = this,
                list = self.getSlots(),
                inventoryList = self.interface.bank.getInventoryList();

            list.empty();

            for (var i = 0; i &lt; self.getInventorySize(); i++) {
                var item = $(inventoryList[i]).clone(),
                    slot = item.find(&apos;#bankInventorySlot&apos; + i);

                slot.click(function(event) {
                    self.select(event);
                });

                list.append(item);
            }

            self.selectedItem.click(function() {
                self.remove(&apos;item&apos;);
            });

            self.selectedShards.click(function() {
                self.remove(&apos;shards&apos;);
            });

        },

        add: function(type, index) {
            var self = this,
                image = self.getSlot(index).find(&apos;#inventoryImage&apos; + index);

            switch (type) {
                case &apos;item&apos;:

                    self.selectedItem.css(&apos;background-image&apos;, image.css(&apos;background-image&apos;));

                    if (Detect.isMobile())
                        self.selectedItem.css(&apos;background-size&apos;, &apos;600%&apos;);

                    break;

                case &apos;shards&apos;:

                    self.selectedShards.css(&apos;background-image&apos;, image.css(&apos;background-image&apos;));

                    if (Detect.isMobile())
                        self.selectedShards.css(&apos;background-size&apos;, &apos;600%&apos;);

                    var count = self.getItemSlot(index).count;

                    if (count &gt; 1)
                        self.shardsCount.text(count);

                    break;
            }

            image.css(&apos;background-image&apos;, &apos;&apos;);

            self.getSlot(index).find(&apos;#inventoryItemCount&apos; + index).text(&apos;&apos;);
        },

        moveBack: function(type, index) {
            var self = this,
                image = self.getSlot(index).find(&apos;#inventoryImage&apos;+ index),
                itemCount = self.getSlot(index).find(&apos;#inventoryItemCount&apos; + index),
                count = self.getItemSlot(index).count;

            switch (type) {
                case &apos;item&apos;:

                    image.css(&apos;background-image&apos;, self.selectedItem.css(&apos;background-image&apos;));

                    if (count &gt; 1)
                        itemCount.text(count);

                    self.selectedItem.css(&apos;background-image&apos;, &apos;&apos;);

                    break;

                case &apos;shards&apos;:

                    image.css(&apos;background-image&apos;, self.selectedShards.css(&apos;background-image&apos;));

                    if (count &gt; 1)
                        itemCount.text(count);

                    self.selectedShards.css(&apos;background-image&apos;, &apos;&apos;);

                    self.shardsCount.text(&apos;&apos;);

                    break;
            }
        },

        enchant: function() {
            this.game.socket.send(Packets.Enchant, [Packets.EnchantOpcode.Enchant]);
        },

        select: function(event) {
            this.game.socket.send(Packets.Enchant, [Packets.EnchantOpcode.Select, event.currentTarget.id.substring(17)]);
        },

        remove: function(type) {
            this.game.socket.send(Packets.Enchant, [Packets.EnchantOpcode.Remove, type]);
        },

        getInventorySize: function() {
            return this.interface.inventory.getSize();
        },

        getItemSlot: function(index) {
            return this.interface.inventory.container.slots[index];
        },

        display: function() {
            var self = this;

            self.body.fadeIn(&apos;fast&apos;);
            self.load();
        },

        hide: function() {
            var self = this;

            self.selectedItem.css(&apos;background-image&apos;, &apos;&apos;);
            self.selectedShards.css(&apos;background-image&apos;, &apos;&apos;);

            self.body.fadeOut(&apos;fast&apos;);
        },

        hasImage: function(image) {
            return image.css(&apos;background-image&apos;) !== &apos;none&apos;;
        },

        getSlot: function(index) {
            return $(this.getSlots().find(&apos;li&apos;)[index]);
        },

        getSlots: function() {
            return this.enchantSlots.find(&apos;ul&apos;);
        },

        isVisible: function() {
            return this.body.css(&apos;display&apos;) === &apos;block&apos;
        }

    });

});</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
