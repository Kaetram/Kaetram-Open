<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">Kaetram-Open/client/js/interface/inventory.js | kaetram</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="Kaetram is an open-source game-engine created to aid those interested in entering the game development realm. The codebase is simple, clean, and intuitive, and is intended to be used as a learning tool. The original idea is based off Little Workshop&apos;s demo game - BrowserQuest. The assets have remained the same, but the code itself has been completely wiped and redone from the ground up."><meta property="twitter:card" content="summary"><meta property="twitter:title" content="kaetram"><meta property="twitter:description" content="Kaetram is an open-source game-engine created to aid those interested in entering the game development realm. The codebase is simple, clean, and intuitive, and is intended to be used as a learning tool. The original idea is based off Little Workshop&apos;s demo game - BrowserQuest. The assets have remained the same, but the code itself has been completely wiped and redone from the ground up."></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/Veradictus/Kaetram-Open"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  </ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">Kaetram-Open/client/js/interface/inventory.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/* global log, Detect, Packets */

define([&apos;jquery&apos;, &apos;./container/container&apos;], function($, Container) {
    return Class.extend({

        init: function(game, size) {
            var self = this;

            self.game = game;
            self.actions = game.interface.actions;

            self.body = $(&apos;#inventory&apos;);
            self.button = $(&apos;#inventoryButton&apos;);
            self.action = $(&apos;#actionContainer&apos;);

            self.container = new Container(size);

            self.activeClass = &apos;inventory&apos;;

            self.selectedSlot = null;
            self.selectedItem = null;
        },

        load: function(data) {
            var self = this,
                list = $(&apos;#inventory&apos;).find(&apos;ul&apos;);

            for (var i = 0; i &lt; data.length; i++) {
                var item = data[i];

                self.container.setSlot(i, item);

                var itemSlot = $(&apos;&lt;div id=&quot;slot&apos; + i + &apos;&quot; class=&quot;itemSlot&quot;&gt;&lt;/div&gt;&apos;);

                if (item.string !== &apos;null&apos;)
                    itemSlot.css(&apos;background-image&apos;, self.container.getImageFormat(self.getScale(), item.string));

                itemSlot.css(&apos;background-size&apos;, &apos;600%&apos;);

                itemSlot.dblclick(function(event) {
                    self.clickDouble(event);
                });

                itemSlot.click(function(event) {
                    self.click(event);
                });

                var itemSlotList = $(&apos;&lt;li&gt;&lt;/li&gt;&apos;),
                    count = item.count;

                if (count &gt; 999999)
                    count = count.toString().substring(0, count.toString().length - 6) + &apos;M&apos;;
                else if (count &gt; 9999)
                    count = count.toString().substring(0, 2) + &apos;K&apos;;
                else if (count === 1)
                    count = &apos;&apos;;

                itemSlotList.append(itemSlot);
                itemSlotList.append(&apos;&lt;div id=&quot;itemCount&apos; + i + &apos;&quot; class=&quot;inventoryItemCount&quot;&gt;&apos; + count + &apos;&lt;/div&gt;&apos;);

                list.append(itemSlotList);
            }

            self.button.click(function(event) {
                self.game.interface.hideAll();

                if (self.isVisible())
                    self.hide();
                else
                    self.display();

                self.game.socket.send(Packets.Click, [&apos;inventory&apos;, self.button.hasClass(&apos;active&apos;)]);
            });
        },

        click: function(event) {
            var self = this,
                index = event.currentTarget.id.substring(4),
                slot = self.container.slots[index],
                item = $(self.getList()[index]);

            self.clearSelection();

            if (slot.string === null || slot.count === -1 || slot.string === &apos;null&apos;)
                return;

            self.actions.reset();
            self.actions.loadDefaults(&apos;inventory&apos;);

            if (slot.edible)
                self.actions.add($(&apos;&lt;div id=&quot;eat&quot; class=&quot;actionButton&quot;&gt;Eat&lt;/div&gt;&apos;));
            else if (slot.equippable)
                self.actions.add($(&apos;&lt;div id=&quot;wield&quot; class=&quot;actionButton&quot;&gt;Wield&lt;/div&gt;&apos;));
            else if (slot.count &gt; 999999)
                self.actions.add($(&apos;&lt;div id=&quot;itemInfo&quot; class=&quot;actionButton&quot;&gt;Info&lt;/div&gt;&apos;));

            if (!self.actions.isVisible())
                self.actions.show();

            var sSlot = item.find(&apos;#slot&apos; + index);

            sSlot.addClass(&apos;select&apos;);

            self.selectedSlot = sSlot;
            self.selectedItem = slot;

            self.actions.hideDrop();
        },

        clickDouble: function(event) {
            var self = this,
                index = event.currentTarget.id.substring(4),
                slot = self.container.slots[index];

            if (!slot.edible &amp;&amp; !slot.equippable)
                return;

            var item = $(self.getList()[index]),
                sSlot = item.find(&apos;#slot&apos; + index);

            self.clearSelection();

            self.selectedSlot = sSlot;
            self.selectedItem = slot;

            self.clickAction(slot.edible ? &apos;eat&apos; : &apos;wield&apos;);

            self.actions.hideDrop();
        },

        clickAction: function(event, dAction) {
            var self = this,
                action = event.currentTarget ? event.currentTarget.id : event;

            log.info(action);

            if (!self.selectedSlot || !self.selectedItem)
                return;

            switch (action) {
                case &apos;eat&apos;:
                case &apos;wield&apos;:

                    self.game.socket.send(Packets.Inventory, [Packets.InventoryOpcode.Select, self.selectedItem.index]);
                    self.clearSelection();

                    break;

                case &apos;drop&apos;:
                    var item = self.selectedItem;

                    if (item.count &gt; 1) {
                        if (Detect.isMobile())
                            self.hide(true);

                        self.actions.displayDrop(&apos;inventory&apos;);
                    } else {
                        self.game.socket.send(Packets.Inventory, [Packets.InventoryOpcode.Remove, item]);
                        self.clearSelection();
                    }

                    break;

                case &apos;dropAccept&apos;:

                    var count = $(&apos;#dropCount&apos;).val();

                    if (isNaN(count) || count &lt; 1)
                        return;

                    self.game.socket.send(Packets.Inventory, [Packets.InventoryOpcode.Remove, self.selectedItem, count]);
                    self.actions.hideDrop();
                    self.clearSelection();

                    break;

                case &apos;dropCancel&apos;:

                    self.actions.hideDrop();
                    self.clearSelection();

                    break;

                case &apos;itemInfo&apos;:

                    self.game.input.chatHandler.add(&apos;WORLD&apos;, &apos;You have &apos; + self.selectedItem.count + &apos; coins.&apos;);

                    break;
            }

            self.actions.hide();
        },

        add: function(info) {
            var self = this,
                item = $(self.getList()[info.index]),
                slot = self.container.slots[info.index];

            if (!item || !slot)
                return;

            // Have the server forcefully load data into the slot.
            slot.load(info.string, info.count, info.ability, info.abilityLevel, info.edible, info.equippable);

            var cssSlot = item.find(&apos;#slot&apos; + info.index);

            cssSlot.css(&apos;background-image&apos;, self.container.getImageFormat(self.getScale(), slot.string));

            cssSlot.css(&apos;background-size&apos;, &apos;600%&apos;);

            var count = slot.count;

            if (count &gt; 999999)
                count = count.toString().substring(0, count.toString().length - 6) + &apos;M&apos;;
            else if (count &gt; 9999)
                count = count.toString().substring(0, 2) + &apos;K&apos;;
            else if (count === 1)
                count = &apos;&apos;;

            item.find(&apos;#itemCount&apos; + info.index).text(count);
        },

        remove: function(info) {
            var self = this,
                item = $(self.getList()[info.index]),
                slot = self.container.slots[info.index];

            if (!item || !slot)
                return;

            slot.count -= info.count;

            item.find(&apos;#itemCount&apos; + info.index).text(slot.count);

            if (slot.count &lt; 1) {
                item.find(&apos;#slot&apos; + info.index).css(&apos;background-image&apos;, &apos;&apos;);
                item.find(&apos;#itemCount&apos; + info.index).text(&apos;&apos;);
                slot.empty();
            }
        },

        resize: function() {
            var self = this,
                list = self.getList();

            for (var i = 0; i &lt; list.length; i++) {
                var item = $(list[i]).find(&apos;#slot&apos; + i),
                    slot = self.container.slots[i];

                if (!slot)
                    continue;

                if (Detect.isMobile())
                    item.css(&apos;background-size&apos;, &apos;600%&apos;);
                else
                    item.css(&apos;background-image&apos;, self.container.getImageFormat(self.getScale(), slot.string));
            }
        },

        clearSelection: function() {
            var self = this;

            if (!self.selectedSlot)
                return;

            self.selectedSlot.removeClass(&apos;select&apos;);
            self.selectedSlot = null;
            self.selectedItem = null;
        },

        display: function() {
            var self = this;

            self.body.fadeIn(&apos;fast&apos;);
            self.button.addClass(&apos;active&apos;);
        },

        hide: function(keepSelection) {
            var self = this;

            self.button.removeClass(&apos;active&apos;);

            self.body.fadeOut(&apos;slow&apos;);
            self.button.removeClass(&apos;active&apos;);

            if (!keepSelection)
                self.clearSelection();
        },

        getScale: function() {
            return this.game.renderer.getScale();
        },

        getSize: function() {
            return this.container.size;
        },

        getList: function() {
            return $(&apos;#inventory&apos;).find(&apos;ul&apos;).find(&apos;li&apos;);
        },

        isVisible: function() {
            return this.body.css(&apos;display&apos;) === &apos;block&apos;;
        }

    });
});
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
